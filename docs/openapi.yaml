openapi: 3.1.0
info:
  title: Benicio Advogados API
  version: 1.0.0
  description: |
    ## Welcome to Benicio Advogados API

    A comprehensive legal management system API built with AdonisJS v6 for Benicio Advogados Associados.
    This API provides complete functionality for managing legal cases, clients, documents, and users.

    ### Key Features
    - **Authentication**: JWT-based authentication with access and refresh tokens
    - **Legal Case Management**: Complete CRUD operations for legal cases (folders)
    - **Client Management**: Manage corporate and individual clients with addresses and contacts
    - **Document Management**: Handle legal documents and case files
    - **Role-Based Access Control**: Comprehensive RBAC system with permissions
    - **Audit Logging**: Track all system changes and user actions

    ### Authentication
    Most endpoints require JWT authentication. Use the `/api/v1/sessions/sign-in` endpoint to obtain tokens.
    Include the access token in the Authorization header: `Bearer <token>`

    ### Rate Limiting
    Authentication endpoints are rate-limited to 5 requests per minute.

  contact:
    name: Benicio Advogados
    email: contato@benicio.com.br
    url: https://benicio.com.br
  license:
    name: Proprietary

servers:
  - url: http://localhost:3333
    description: Development server
  - url: https://api.benicio.com.br
    description: Production server

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Folders
    description: Legal case (folder) management
  - name: Clients
    description: Client management with addresses and contacts
  - name: Users
    description: User profile and management
  - name: Roles
    description: Role and permission management
  - name: Health
    description: System health check

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from sign-in endpoint

  schemas:
    Error:
      type: object
      properties:
        message:
          type: string
          description: Error message
        status:
          type: integer
          description: HTTP status code
        errors:
          type: array
          items:
            type: object
            properties:
              message:
                type: string
              field:
                type: string
              rule:
                type: string

    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        full_name:
          type: string
          example: 'Employee Benício'
        email:
          type: string
          format: email
          example: 'employee@benicio.com.br'
        username:
          type: string
          example: 'employee'
        user_type:
          type: string
          enum: [manager, employee]
          example: 'employee'
        metadata:
          type: object
          properties:
            email_verified:
              type: boolean
            email_verified_at:
              type: string
              format: date-time
            email_verification_token:
              type: string
            email_verification_sent_at:
              type: string
              format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Role:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          example: 'Admin'
        slug:
          type: string
          example: 'admin'
        description:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AuthTokens:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token (expires in 15 minutes)
        refresh_token:
          type: string
          description: JWT refresh token (expires in 3 days)

    AuthResponse:
      type: object
      properties:
        id:
          type: integer
        full_name:
          type: string
        email:
          type: string
        username:
          type: string
        metadata:
          type: object
        user_type:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
        auth:
          $ref: '#/components/schemas/AuthTokens'

    Client:
      type: object
      properties:
        id:
          type: integer
        person_type:
          type: string
          enum: [individual, company]
        fantasy_name:
          type: string
        company_name:
          type: string
          nullable: true
        document:
          type: string
          description: CPF or CNPJ
        document_type:
          type: string
          enum: [cpf, cnpj]
        state_registration:
          type: string
          nullable: true
        municipal_registration:
          type: string
          nullable: true
        email:
          type: string
          format: email
        phone:
          type: string
        mobile:
          type: string
        website:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
        client_type:
          type: string
          enum: [prospect, client, prospect_sic, prospect_dbm]
        is_active:
          type: boolean
        is_favorite:
          type: boolean
        metadata:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Folder:
      type: object
      properties:
        id:
          type: integer
        cnj_number:
          type: string
          pattern: '^[0-9]{7}-[0-9]{2}\.[0-9]{4}\.[0-9]\.[0-9]{2}\.[0-9]{4}$'
          example: '0000085-78.2023.8.06.0001'
          description: CNJ (Conselho Nacional de Justiça) case number
        internal_client_code:
          type: string
          nullable: true
        title:
          type: string
          example: 'Ação Ordinária - Restituição PIS/COFINS'
        description:
          type: string
          nullable: true
        client_id:
          type: integer
        folder_type_id:
          type: integer
        court_id:
          type: integer
          nullable: true
        responsible_lawyer_id:
          type: integer
          nullable: true
        parent_folder_id:
          type: integer
          nullable: true
        path:
          type: string
          nullable: true
        level:
          type: integer
        status:
          type: string
          enum: [pending, active, in_progress, completed, archived, suspended]
        instance:
          type: string
          enum: [first, second, superior]
        nature:
          type: string
          enum: [judicial, administrative, extrajudicial]
        action_type:
          type: string
        electronic:
          type: boolean
        phase:
          type: string
          enum: [knowledge, compliance, appeal]
        prognosis:
          type: string
          nullable: true
        comarca:
          type: string
          nullable: true
        distribution_type:
          type: string
        case_value:
          type: string
          format: decimal
          nullable: true
        conviction_value:
          type: string
          format: decimal
          nullable: true
        costs:
          type: string
          format: decimal
          nullable: true
        fees:
          type: string
          format: decimal
          nullable: true
        is_active:
          type: boolean
        is_favorite:
          type: boolean
        priority:
          type: string
          enum: [low, medium, high, critical]
        migrated:
          type: boolean
        search_intimation:
          type: boolean
        search_progress:
          type: boolean
        loy_integration_data:
          type: object
          nullable: true
        cover_information_updated_at:
          type: string
          format: date-time
          nullable: true
        distribution_date:
          type: string
          format: date
          nullable: true
        citation_date:
          type: string
          format: date
          nullable: true
        next_hearing_date:
          type: string
          format: date
          nullable: true
        prescription_date:
          type: string
          format: date
          nullable: true
        closure_date:
          type: string
          format: date
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
          nullable: true

    PaginationMeta:
      type: object
      properties:
        total:
          type: integer
        per_page:
          type: integer
        current_page:
          type: integer
        last_page:
          type: integer
        first_page:
          type: integer
        first_page_url:
          type: string
        last_page_url:
          type: string
        next_page_url:
          type: string
          nullable: true
        previous_page_url:
          type: string
          nullable: true

    FolderStats:
      type: object
      properties:
        total:
          type: integer
          description: Total number of folders
        active:
          type: integer
          description: Number of active folders
        archived:
          type: integer
          description: Number of archived folders
        highPriority:
          type: integer
          description: Number of high priority folders
        withCnj:
          type: integer
          description: Number of folders with CNJ number

    CnjValidation:
      type: object
      properties:
        valid:
          type: boolean
        formatted:
          type: string
        details:
          type: object
          properties:
            sequential:
              type: string
            digit:
              type: string
            year:
              type: string
            segment:
              type: string
            court:
              type: string
            origin:
              type: string

paths:
  # ===== HEALTH =====
  /api/v1/health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the API is running and healthy
      operationId: healthCheck
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: 'healthy'
                  timestamp:
                    type: string
                    format: date-time

  # ===== AUTHENTICATION =====
  /api/v1/sessions/sign-in:
    post:
      tags:
        - Authentication
      summary: User login
      description: |
        Authenticate user with email/username and password.
        Returns user data with JWT tokens.
      operationId: signIn
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - uid
                - password
              properties:
                uid:
                  type: string
                  description: Email address or username
                  example: 'employee@benicio.com.br'
                password:
                  type: string
                  format: password
                  example: 'benicio123'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                id: 1
                full_name: 'Employee Benício'
                email: 'employee@benicio.com.br'
                username: 'employee'
                user_type: 'employee'
                metadata:
                  email_verified: true
                  email_verified_at: '2025-09-29T20:29:17.627+00:00'
                roles:
                  - id: 1
                    name: 'Root'
                    slug: 'root'
                  - id: 2
                    name: 'Admin'
                    slug: 'admin'
                auth:
                  access_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI...'
                  refresh_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI...'
        '400':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/sessions/sign-up:
    post:
      tags:
        - Authentication
      summary: User registration
      description: Create a new user account
      operationId: signUp
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - full_name
                - email
                - username
                - password
                - password_confirmation
              properties:
                full_name:
                  type: string
                  example: 'João Silva'
                email:
                  type: string
                  format: email
                  example: 'joao.silva@benicio.com.br'
                username:
                  type: string
                  example: 'joaosilva'
                password:
                  type: string
                  format: password
                  minLength: 8
                password_confirmation:
                  type: string
                  format: password
                user_type:
                  type: string
                  enum: [manager, employee]
                  default: employee
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/sessions/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: |
        Logout current user.
        Note: JWT tokens are stateless. This endpoint relies on client-side token removal.
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logged out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Logged out successfully'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/sessions/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh token
      description: Refresh access token using refresh token
      operationId: refreshToken
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
                  description: Refresh token obtained from login
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/AuthTokens'
        '400':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== USER PROFILE =====
  /api/v1/me:
    get:
      tags:
        - Users
      summary: Get current user profile
      description: Get authenticated user information
      operationId: getProfile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized

  /api/v1/me/permissions:
    get:
      tags:
        - Users
      summary: Get user permissions
      description: Get all permissions for authenticated user
      operationId: getUserPermissions
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User permissions
          content:
            application/json:
              schema:
                type: object
                properties:
                  permissions:
                    type: array
                    items:
                      type: string
                    example: ['folders.read', 'folders.write', 'clients.read']
        '401':
          description: Unauthorized

  /api/v1/me/roles:
    get:
      tags:
        - Users
      summary: Get user roles
      description: Get all roles for authenticated user
      operationId: getUserRoles
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User roles
          content:
            application/json:
              schema:
                type: object
                properties:
                  roles:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'
        '401':
          description: Unauthorized

  # ===== FOLDERS (LEGAL CASES) =====
  /api/v1/folders:
    get:
      tags:
        - Folders
      summary: List folders
      description: Get paginated list of legal cases (folders)
      operationId: listFolders
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: per_page
          in: query
          description: Items per page
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: search
          in: query
          description: Search term for title or CNJ number
          schema:
            type: string
        - name: status
          in: query
          description: Filter by status
          schema:
            type: string
            enum: [pending, active, in_progress, completed, archived, suspended]
        - name: folder_type_id
          in: query
          description: Filter by folder type ID
          schema:
            type: integer
        - name: client_id
          in: query
          description: Filter by client ID
          schema:
            type: integer
        - name: court_id
          in: query
          description: Filter by court ID
          schema:
            type: integer
        - name: sort_by
          in: query
          description: Sort field
          schema:
            type: string
            default: created_at
            enum: [created_at, updated_at, title, case_value, distribution_date]
        - name: sort_order
          in: query
          description: Sort order
          schema:
            type: string
            default: desc
            enum: [asc, desc]
      responses:
        '200':
          description: List of folders
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folders retrieved successfully'
                  data:
                    type: object
                    properties:
                      meta:
                        $ref: '#/components/schemas/PaginationMeta'
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Folder'
        '401':
          description: Unauthorized

    post:
      tags:
        - Folders
      summary: Create folder
      description: Create a new legal case (folder)
      operationId: createFolder
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - client_id
                - folder_type_id
              properties:
                cnj_number:
                  type: string
                  pattern: '^[0-9]{7}-[0-9]{2}\.[0-9]{4}\.[0-9]\.[0-9]{2}\.[0-9]{4}$'
                internal_client_code:
                  type: string
                title:
                  type: string
                  minLength: 3
                  maxLength: 255
                description:
                  type: string
                  maxLength: 1000
                client_id:
                  type: integer
                folder_type_id:
                  type: integer
                court_id:
                  type: integer
                responsible_lawyer_id:
                  type: integer
                parent_folder_id:
                  type: integer
                status:
                  type: string
                  enum: [pending, active, in_progress, completed, archived, suspended]
                  default: pending
                instance:
                  type: string
                  enum: [first, second, superior]
                  default: first
                nature:
                  type: string
                  enum: [judicial, administrative, extrajudicial]
                  default: judicial
                action_type:
                  type: string
                electronic:
                  type: boolean
                  default: true
                phase:
                  type: string
                  enum: [knowledge, compliance, appeal]
                  default: knowledge
                prognosis:
                  type: string
                comarca:
                  type: string
                distribution_type:
                  type: string
                case_value:
                  type: number
                  minimum: 0
                priority:
                  type: string
                  enum: [low, medium, high, critical]
                  default: medium
                search_intimation:
                  type: boolean
                  default: true
                search_progress:
                  type: boolean
                  default: true
                distribution_date:
                  type: string
                  format: date
                citation_date:
                  type: string
                  format: date
                next_hearing_date:
                  type: string
                  format: date
                prescription_date:
                  type: string
                  format: date
      responses:
        '201':
          description: Folder created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folder created successfully'
                  data:
                    $ref: '#/components/schemas/Folder'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized

  /api/v1/folders/stats:
    get:
      tags:
        - Folders
      summary: Get folder statistics
      description: Get aggregated statistics about folders
      operationId: getFolderStats
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Folder statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folder statistics retrieved successfully'
                  data:
                    $ref: '#/components/schemas/FolderStats'
              example:
                message: 'Folder statistics retrieved successfully'
                data:
                  total: 85
                  active: 31
                  archived: 0
                  highPriority: 10
                  withCnj: 85
        '401':
          description: Unauthorized

  /api/v1/folders/favorites:
    get:
      tags:
        - Folders
      summary: List favorite folders
      description: Get paginated list of folders marked as favorites
      operationId: getFavoriteFolders
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: List of favorite folders
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Favorite folders retrieved successfully'
                  data:
                    type: object
                    properties:
                      meta:
                        $ref: '#/components/schemas/PaginationMeta'
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Folder'
        '401':
          description: Unauthorized

  /api/v1/folders/validate-cnj:
    post:
      tags:
        - Folders
      summary: Validate CNJ number
      description: |
        Validate a CNJ (Conselho Nacional de Justiça) number format and check digit.
        CNJ format: NNNNNNN-DD.AAAA.J.TT.OOOO
      operationId: validateCnj
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - cnj_number
              properties:
                cnj_number:
                  type: string
                  example: '0000085-78.2023.8.06.0001'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'CNJ validation completed'
                  data:
                    $ref: '#/components/schemas/CnjValidation'
        '401':
          description: Unauthorized

  /api/v1/folders/{id}:
    get:
      tags:
        - Folders
      summary: Get folder by ID
      description: Get a specific folder with all relationships
      operationId: getFolder
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Folder ID
          schema:
            type: integer
      responses:
        '200':
          description: Folder details
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folder retrieved successfully'
                  data:
                    $ref: '#/components/schemas/Folder'
        '404':
          description: Folder not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized

    put:
      tags:
        - Folders
      summary: Update folder
      description: Update an existing folder
      operationId: updateFolder
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Folder ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cnj_number:
                  type: string
                title:
                  type: string
                description:
                  type: string
                client_id:
                  type: integer
                folder_type_id:
                  type: integer
                court_id:
                  type: integer
                responsible_lawyer_id:
                  type: integer
                status:
                  type: string
                  enum: [pending, active, in_progress, completed, archived, suspended]
                instance:
                  type: string
                  enum: [first, second, superior]
                nature:
                  type: string
                  enum: [judicial, administrative, extrajudicial]
                action_type:
                  type: string
                electronic:
                  type: boolean
                phase:
                  type: string
                  enum: [knowledge, compliance, appeal]
                prognosis:
                  type: string
                comarca:
                  type: string
                distribution_type:
                  type: string
                case_value:
                  type: number
                priority:
                  type: string
                  enum: [low, medium, high, critical]
                search_intimation:
                  type: boolean
                search_progress:
                  type: boolean
                distribution_date:
                  type: string
                  format: date
                citation_date:
                  type: string
                  format: date
                next_hearing_date:
                  type: string
                  format: date
                prescription_date:
                  type: string
                  format: date
      responses:
        '200':
          description: Folder updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folder updated successfully'
                  data:
                    $ref: '#/components/schemas/Folder'
        '404':
          description: Folder not found
        '422':
          description: Validation error
        '401':
          description: Unauthorized

    delete:
      tags:
        - Folders
      summary: Delete folder
      description: Soft delete a folder (can be restored)
      operationId: deleteFolder
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Folder ID
          schema:
            type: integer
      responses:
        '200':
          description: Folder deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folder deleted successfully'
        '404':
          description: Folder not found
        '401':
          description: Unauthorized

  /api/v1/folders/{id}/favorite:
    patch:
      tags:
        - Folders
      summary: Toggle favorite status
      description: Toggle folder favorite status (favorite/unfavorite)
      operationId: toggleFavorite
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Folder ID
          schema:
            type: integer
      responses:
        '200':
          description: Favorite status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folder favorite status updated successfully'
                  data:
                    $ref: '#/components/schemas/Folder'
        '404':
          description: Folder not found
        '401':
          description: Unauthorized

  /api/v1/folders/{id}/restore:
    post:
      tags:
        - Folders
      summary: Restore deleted folder
      description: Restore a soft deleted folder
      operationId: restoreFolder
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Folder ID
          schema:
            type: integer
      responses:
        '200':
          description: Folder restored successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Folder restored successfully'
                  data:
                    $ref: '#/components/schemas/Folder'
        '404':
          description: Folder not found
        '401':
          description: Unauthorized

  # ===== CLIENTS =====
  /api/v1/clients:
    get:
      tags:
        - Clients
      summary: List clients
      description: |
        Get paginated list of clients.
        Requires permission: `clients.read`
      operationId: listClients
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
        - name: search
          in: query
          description: Search by name, document or email
          schema:
            type: string
        - name: person_type
          in: query
          schema:
            type: string
            enum: [individual, company]
        - name: client_type
          in: query
          schema:
            type: string
            enum: [prospect, client, prospect_sic, prospect_dbm]
        - name: is_active
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of clients
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      meta:
                        $ref: '#/components/schemas/PaginationMeta'
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Client'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                status: 403
                message: 'Insufficient permissions. Required: clients.read'
        '401':
          description: Unauthorized

  # ===== ROLES =====
  /api/v1/roles:
    get:
      tags:
        - Roles
      summary: List roles
      description: |
        Get list of all roles.
        Requires permission: `roles.read`
      operationId: listRoles
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of roles
          content:
            application/json:
              schema:
                type: object
                properties:
                  roles:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'
        '403':
          description: Insufficient permissions
        '401':
          description: Unauthorized

  /api/v1/roles/attach:
    put:
      tags:
        - Roles
      summary: Attach role to user
      description: |
        Attach a role to a user.
        Requires permission: `roles.write`
      operationId: attachRole
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - role_id
              properties:
                user_id:
                  type: integer
                role_id:
                  type: integer
      responses:
        '200':
          description: Role attached successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Role attached successfully'
        '403':
          description: Insufficient permissions
        '401':
          description: Unauthorized

  # ===== EMAIL VERIFICATION =====
  /api/v1/verify-email:
    get:
      tags:
        - Users
      summary: Verify email
      description: Verify user email with token sent to email
      operationId: verifyEmail
      security:
        - bearerAuth: []
      parameters:
        - name: token
          in: query
          required: true
          description: Email verification token
          schema:
            type: string
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Email verified successfully'
        '400':
          description: Invalid or expired token
        '401':
          description: Unauthorized

security:
  - bearerAuth: []
